<div class="container" >
  <div *ngIf="loading" class="loading">
    Loadingâ€¦
  </div>
    <div *ngIf="!loading && (contact || isNew)">

  <!-- Top Bar for Actions -->
  <header class="detail-header" *ngIf="!isNew && !editMode">
    <button class="back-btn" (click)="back()">&lt;</button>
    <div class="actions">
      <button class="action-btn" (click)="edit()">Edit</button>
      <button class="action-btn delete" (click)="delete()">Delete</button>
    </div>
  </header>

  <!-- EDIT MODE -->
  <ng-container *ngIf="editMode; else viewMode">
    <form [formGroup]="form" (ngSubmit)="save()" novalidate>
      <!-- Profile Header in Edit -->
      <div class="profile-header">
        <img [src]="form.get('picture')?.value || 'https://via.placeholder.com/100'" class="profile-pic" alt="Profile">
        <input formControlName="name" class="name-input" placeholder="Name" />
        <div class="error" *ngIf="form.get('name')?.touched && form.get('name')?.invalid">
          {{ form.get('name')?.hasError('required') ? 'Name is required' : 'Name must be at least 2 characters' }}
        </div>
        <input formControlName="address" class="company-input" placeholder="Company/Affiliation" />
        <div class="error" *ngIf="form.get('address')?.touched && form.get('address')?.hasError('required')">
          Address is required
        </div>
      </div>

      <!-- Contact Info in Edit -->
      <div class="details">
        <div class="detail-item">
          <span class="icon">ğŸ“±</span>
          <span>Mobile</span>
          <input formControlName="cell" type="tel" placeholder="Mobile number" />
        </div>
        <div class="detail-item">
          <span class="icon">â˜ï¸</span>
          <span>Work</span>
          <input formControlName="phone" type="tel" placeholder="Work number" />
          <div class="error" *ngIf="form.get('phone')?.touched && form.get('phone')?.invalid">
            {{ form.get('phone')?.hasError('required') ? 'Phone is required' : 'Invalid phone number' }}
          </div>
        </div>
        <div class="detail-item">
          <span class="icon">âœ‰ï¸</span>
          <input formControlName="email" type="email" placeholder="Email" />
          <div class="error" *ngIf="form.get('email')?.touched && form.get('email')?.invalid">
            {{ form.get('email')?.hasError('required') ? 'Email is required' : 'Enter a valid email' }}
          </div>
        </div>
      </div>

      <!-- Additional Fields -->
      <div class="additional">
        <label>Registration Date <span class="req">*</span></label>
        <input formControlName="registered" type="date" />
        <div class="error" *ngIf="form.get('registered')?.touched && form.get('registered')?.hasError('required')">
          Date is required
        </div>

        <label>Age</label>
        <input formControlName="age" type="number" />
        <div class="error" *ngIf="form.get('age')?.touched && form.get('age')?.invalid">
          {{ form.get('age')?.hasError('min') ? 'Age must be â‰¥ 0' : 'Age must be â‰¤ 150' }}
        </div>

        <label>Image URL <span class="req">*</span></label>
        <input formControlName="picture" placeholder="https://..." />
        <div class="error" *ngIf="form.get('picture')?.touched && form.get('picture')?.invalid">
          {{ form.get('picture')?.hasError('required') ? 'Image URL is required' : 'Must be a valid http/https URL' }}
        </div>
      </div>

      <!-- Form Footer -->
      <div class="form-footer">
        <div class="error" *ngIf="error">{{ error }}</div>
        <button type="submit" class="save-btn" [disabled]="form.invalid || loading">
          {{ loading ? 'Saving...' : 'Save' }}
        </button>
      </div>
    </form>
  </ng-container>

  <!-- VIEW MODE -->
  <ng-template #viewMode>
    <div class="profile-header">
      <img [src]="contact?.picture || 'https://via.placeholder.com/100'" class="profile-pic" alt="Profile">
      <h2>{{ contact?.name }}</h2>
      <p class="company">{{ contact?.address }}</p>
    </div>

    <div class="details">
      <div class="detail-item">
        <span class="icon">ğŸ“±</span>
        <span>Mobile</span>
        <a [href]="'tel:' + contact?.cell">{{ contact?.cell || 'â€”' }}</a>
      </div>
      <div class="detail-item">
        <span class="icon">â˜ï¸</span>
        <span>Work</span>
        <a [href]="'tel:' + contact?.phone">{{ contact?.phone }}</a>
      </div>
      <div class="detail-item">
        <span class="icon">âœ‰ï¸</span>
        <a [href]="'mailto:' + contact?.email">{{ contact?.email }}</a>
      </div>
    </div>

    <div class="additional">
      <p><strong>Registered:</strong> {{ contact?.registered | date:'mediumDate' }}</p>
      <p><strong>Age:</strong> {{ contact?.age || 'â€”' }}</p>
    </div>
  </ng-template>
  </div>
</div>